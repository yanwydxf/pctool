(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-system-menu-list"],{1148:function(n,t,e){"use strict";var i=e("a691"),a=e("1d80");n.exports="".repeat||function(n){var t=String(a(this)),e="",u=i(n);if(u<0||u==1/0)throw RangeError("Wrong number of repetitions");for(;u>0;(u>>>=1)&&(t+=t))1&u&&(e+=t);return e}},"2d95":function(n,t,e){"use strict";e.r(t);var i=e("8573"),a=e("7906");for(var u in a)"default"!==u&&function(n){e.d(t,n,(function(){return a[n]}))}(u);e("a7da");var s,r=e("f0c5"),o=Object(r["a"])(a["default"],i["b"],i["c"],!1,null,"9ac0cab4",null,!1,i["a"],s);t["default"]=o.exports},"38cf":function(n,t,e){var i=e("23e7"),a=e("1148");i({target:"String",proto:!0},{repeat:a})},7906:function(n,t,e){"use strict";e.r(t);var i=e("f2ee"),a=e.n(i);for(var u in i)"default"!==u&&function(n){e.d(t,n,(function(){return i[n]}))}(u);t["default"]=a.a},8573:function(n,t,e){"use strict";e.d(t,"b",(function(){return a})),e.d(t,"c",(function(){return u})),e.d(t,"a",(function(){return i}));var i={uniStatBreadcrumb:e("4f97").default,uniBadge:e("9fa8").default,unicloudDb:e("960d").default,uniTable:e("d108").default,uniTr:e("b78e").default,uniTh:e("4b7a").default,uniTd:e("9ec9").default},a=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("v-uni-view",[e("v-uni-view",{staticClass:"uni-header"},[e("uni-stat-breadcrumb",{staticClass:"uni-stat-breadcrumb-on-phone"})],1),e("v-uni-view",{staticClass:"uni-tabs__header"},[e("v-uni-view",{staticClass:"uni-tabs__nav-wrap"},[e("v-uni-view",{staticClass:"uni-tabs__nav-scroll"},[e("v-uni-view",{staticClass:"uni-tabs__nav"},[e("v-uni-view",{staticClass:"uni-tabs__item",class:{"is-active":"menus"===n.currentTab},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.switchTab("menus")}}},[n._v(n._s(n.$t("menu.text.menuManager")))]),n.pluginMenus.length?e("v-uni-view",{staticClass:"uni-tabs__item",class:{"is-active":"pluginMenus"===n.currentTab},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.switchTab("pluginMenus")}}},[n._v(n._s(n.$t("menu.text.additiveMenu"))),e("uni-badge",{staticClass:"menu-badge",attrs:{text:n.pluginMenus.length,type:"error"}})],1):n._e()],1)],1)],1)],1),e("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:"menus"===n.currentTab,expression:"currentTab==='menus'"}]},[e("v-uni-view",{staticClass:"uni-header",staticStyle:{"border-bottom":"0","margin-bottom":"-15px"}},[e("v-uni-view",{staticClass:"uni-group"},[e("v-uni-button",{attrs:{size:"mini",plain:"true",type:"primary"},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.navigateTo("./add")}}},[n._v(n._s(n.$t("menu.button.addFirstLevelMenu")))])],1),e("v-uni-view",{staticClass:"uni-group"})],1),e("v-uni-view",{staticClass:"uni-container"},[e("unicloud-db",{ref:"udb",attrs:{collection:"opendb-admin-menus",options:n.options,where:n.where,"page-data":"replace",orderby:n.orderby,getcount:!0,"page-size":n.options.pageSize,"page-current":n.options.pageCurrent},on:{load:function(t){arguments[0]=t=n.$handleEvent(t),n.onqueryload.apply(void 0,arguments)}},scopedSlots:n._u([{key:"default",fn:function(t){var i=t.data,a=(t.pagination,t.loading);t.error;return[e("uni-table",{staticClass:"table-pc",attrs:{loading:a,emptyText:n.errMsg||n.$t("common.empty"),border:!0,stripe:!0}},[e("uni-tr",[e("uni-th",{attrs:{align:"center"}},[n._v("排序")]),e("uni-th",{attrs:{width:"200",align:"center"}},[n._v("名称")]),e("uni-th",{attrs:{align:"center"}},[n._v("标识")]),e("uni-th",{attrs:{align:"center"}},[n._v("URL")]),e("uni-th",{attrs:{width:"100",align:"center"}},[n._v("是否启用")]),e("uni-th",{attrs:{align:"center"}},[n._v("操作")])],1),n._l(i,(function(t,i){return e("uni-tr",{key:i},[e("uni-td",{attrs:{align:"center"}},[n._v(n._s(t.sort))]),e("uni-td",[n._v(n._s(t.name))]),e("uni-td",[n._v(n._s(t.menu_id))]),e("uni-td",[n._v(n._s(t.url))]),e("uni-td",{class:{"menu-disable":!t.enable},attrs:{align:"center"}},[n._v(n._s(t.enable?"已启用":"未启用"))]),e("uni-td",{attrs:{align:"center"}},[e("v-uni-view",{staticClass:"uni-group",staticStyle:{"justify-content":"left"}},[e("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"primary"},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateTo("./edit?id="+t._id,!1)}}},[n._v(n._s(n.$t("common.button.edit")))]),"system_menu"!==t.menu_id&&"system_management"!==t.menu_id?e("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"warn"},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.confirmDelete(t)}}},[n._v(n._s(n.$t("common.button.delete")))]):n._e(),t.url?n._e():e("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"primary"},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateTo("./add?parent_id="+t.menu_id,!1)}}},[n._v(n._s(n.$t("menu.button.addChildMenu")))])],1)],1)],1)}))],2)]}}])})],1)],1),e("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:"pluginMenus"===n.currentTab,expression:"currentTab==='pluginMenus'"}]},[e("v-uni-view",{staticClass:"uni-header",staticStyle:{"border-bottom":"0","margin-bottom":"-15px"}},[e("v-uni-view",{staticClass:"uni-group"},[e("v-uni-button",{staticStyle:{width:"130px"},attrs:{size:"mini",type:"primary"},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.addPluginMenus.apply(void 0,arguments)}}},[n._v("添加选中的菜单")])],1),e("v-uni-view",{staticClass:"uni-group"})],1),e("v-uni-view",{staticClass:"uni-container"},[e("uni-table",{ref:"pluginMenusTable",attrs:{type:"selection",border:!0,stripe:!0},on:{"selection-change":function(t){arguments[0]=t=n.$handleEvent(t),n.pluginMenuSelectChange.apply(void 0,arguments)}}},[e("uni-tr",[e("uni-th",{attrs:{align:"center"}},[n._v("名称（标识）")]),e("uni-th",{attrs:{align:"center"}},[n._v("URL")]),e("uni-th",{attrs:{align:"center"}},[n._v("插件菜单 json 文件")])],1),n._l(n.pluginMenus,(function(t,i){return e("uni-tr",{key:i},[e("uni-td",[n._v(n._s(t.name)+"（"+n._s(t.menu_id)+"）")]),e("uni-td",[n._v(n._s(t.url))]),e("uni-td",[n._v(n._s(t.json))])],1)}))],2),e("v-uni-view",{staticClass:"uni-sub-title",staticStyle:{"margin-top":"15px"}},[n._v("以上待添加菜单来自于三方插件，添加后，将显示在菜单管理中，若不希望显示在上述表格中时，可手动删除项目中对应的`插件id-menu.json`文件。")])],1)],1)],1)},u=[]},a7da:function(n,t,e){"use strict";var i=e("d3ab"),a=e.n(i);a.a},bf4b:function(n,t,e){var i=e("24fb");t=i(!1),t.push([n.i,"\n.menu-disable[data-v-9ac0cab4]{color:red}.menu-badge[data-v-9ac0cab4]{position:absolute;top:0;right:5px}",""]),n.exports=t},d3ab:function(n,t,e){var i=e("bf4b");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[n.i,i,""]]),i.locals&&(n.exports=i.locals);var a=e("4f06").default;a("02056ec0",i,!0,{sourceMap:!1,shadowMode:!1})},f2ee:function(n,t,e){"use strict";(function(n){var i=e("4ea4");e("99af"),e("7db0"),e("4160"),e("d81d"),e("45fc"),e("d3b7"),e("38cf"),e("159b"),e("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(e("2909")),u=e("4e86"),s=(n.database(),"create_date asc"),r=2e4,o=1,c=[];function l(n,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n.forEach((function(i){i.menu_id===t&&i.parent_id&&(e=e+1+l(n,i.parent_id,e))})),e}function d(n,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return n.find((function(n){return n.parent_id===t}))&&n.forEach((function(i){i.parent_id===t&&(e.push(i._id),d(n,i.menu_id,e))})),e}var v={data:function(){return{query:"",where:"",orderby:s,options:{pageSize:r,pageCurrent:o},selectedIndexs:[],loading:!0,menus:[],errMsg:"",currentTab:"menus",selectedPluginMenuIndexs:[]}},computed:{pluginMenus:function(){var n=[];if(!this.$hasRole("admin"))return n;var t=this.menus;return t.length?(c.forEach((function(e){t.find((function(n){return n.menu_id===e.menu_id}))||n.push(e)})),n):n}},watch:{pluginMenus:function(n){n.length||(this.currentTab="menus")}},methods:{getSortMenu:function(n){return n.map((function(t){n.some((function(n){return n.parent_id===t.menu_id}))||(t.isLeafNode=!0)})),(0,u.buildMenus)(n)},onqueryload:function(n){for(var t=0;t<n.length;t++){var e=n[t],i=l(n,e.menu_id);e.name=(i?"　".repeat(i)+"|-":"")+e.name}var a=this.getSortMenu(n),u=[];this.patTree(a,u),n.length=0,n.push.apply(n,u),this.menus=n},patTree:function(n,t){var e=this;return n.forEach((function(n){t.push(n),n.children.length&&e.patTree(n.children,t)})),t},switchTab:function(n){this.currentTab=n},loadData:function(){var n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$refs.udb.loadData({clear:n})},navigateTo:function(n,t){var e=this;uni.navigateTo({url:n,events:{refreshData:function(){e.loadData(t)}}})},confirmDelete:function(n){var t=this,e=n._id,i="是否删除该菜单？",u=d(this.menus,n.menu_id);u.length&&(i="是否删除该菜单及其子菜单？"),e=[e].concat((0,a.default)(u)),uni.showModal({title:"提示",content:i,success:function(n){n.confirm&&t.$refs.udb.remove(e,{needConfirm:!1})}})},pluginMenuSelectChange:function(n){this.selectedPluginMenuIndexs=n.detail.index},addPluginMenus:function(t){var e=this;if(!this.selectedPluginMenuIndexs.length)return uni.showModal({title:"提示",content:"请选择要添加的菜单！",showCancel:!1});var i=this.pluginMenus,a=[];this.selectedPluginMenuIndexs.forEach((function(n){var t=i[n];if(t){var e=JSON.parse(JSON.stringify(t));delete e.json,a.push(e)}})),uni.showModal({title:"提示",content:"您确认要添加已选中的菜单吗？",success:function(t){if(t.confirm){uni.showLoading({mask:!0});var u=a.length===i.length;n.database().collection("opendb-admin-menus").add(a).then((function(n){e.init(),uni.showModal({title:"提示",content:"添加菜单成功！",showCancel:!1,success:function(){e.$refs.pluginMenusTable.clearSelection(),u&&(e.currentTab="menus"),e.loadData()}})})).catch((function(n){uni.showModal({title:"提示",content:n.message,showCancel:!1})})).finally((function(){uni.hideLoading()}))}}})}}};t.default=v}).call(this,e("a9ff")["default"])}}]);